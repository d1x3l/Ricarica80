<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ricarica 80% – Dacia Spring</title>

  <link rel="shortcut icon" href="icons/icon-192.png" type="image/png">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">
  <link rel="icon" href="icons/icon-512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">

  <meta name="theme-color" content="#00aaff">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ricarica 80%">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    :root {--primary:#00aaff;--dark:#0f0f15;--gray:#222;--light-gray:#bbb;--bg:linear-gradient(135deg,#0f0f15,#1a1a1f);}
    * {box-sizing:border-box;margin:0;padding:0;}
    body {font-family:'Roboto',sans-serif;background:var(--bg);color:white;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
    .container {background:var(--dark);padding:30px 25px;border-radius:25px;box-shadow:0 12px 30px rgba(0,0,0,0.6);max-width:480px;width:100%;display:flex;flex-direction:column;gap:20px;}
    h1 {text-align:center;font-size:30px;color:var(--primary);font-weight:700;}
    .subtitle {text-align:center;color:var(--light-gray);font-size:14px;line-height:1.4;margin-bottom:15px;}
    label {font-weight:500;margin-bottom:5px;font-size:14px;}
    input, select {width:100%;padding:12px 14px;border-radius:12px;border:none;background:var(--gray);color:white;font-size:15px;}
    .temp-section {background:rgba(0,170,255,0.1);padding:15px;border-radius:10px;}
    .temp-section input[type="checkbox"] {width:auto;margin-right:10px;vertical-align:middle;}
    button {margin-top:25px;padding:15px;background:var(--primary);color:white;border:none;border-radius:10px;font-size:18px;font-weight:bold;cursor:pointer;transition:.3s;}
    button:hover {background:#0088cc;}
    .result {background:rgba(0,170,255,0.1);border-radius:16px;padding:20px;text-align:center;display:none;flex-direction:column;gap:10px;}
    .result.show {display:flex;}
    .time {font-size:32px;font-weight:700;color:var(--primary);}
    .impact {font-size:14px;color:#ffaa00;}
    .disclaimer {font-size:12px;color:var(--light-gray);line-height:1.4;margin-top:10px;text-align:center;}
    #temperatura {display:none;margin-top:10px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Ricarica 80%</h1>
    <div class="subtitle">Solo modalità manuale – calibrata sulla tua Dacia Spring</div>

    <div class="temp-section">
      <label><input type="checkbox" id="usaTemp" onchange="toggleTemp()"/> Considera temperatura ambiente</label>
      <div class="disclaimer">Curva aggiornata a dicembre 2025 con i tuoi test reali</div>
      <select id="temperatura">
        <option value="40">40°C – Molto caldo</option>
        <option value="35">35°C – Caldo intenso</option>
        <option value="30">30°C – Caldo</option>
        <option value="25" selected>25°C – Ideale</option>
        <option value="20">20°C – Normale</option>
        <option value="15">15°C – Fresco</option>
        <option value="10">10°C – Freddino</option>
        <option value="5">5°C – Freddo</option>
        <option value="3">3°C – Molto freddo</option>
        <option value="0">0°C – Invernale</option>
        <option value="-5">-5°C – Gelo</option>
      </select>
    </div>

    <div>
      <label>Modello auto</label>
      <select id="modelloAuto" onchange="impostaCapacita()">
        <option value="altro">Altro (inserisci manualmente)</option>
        <option value="spring" selected>Dacia Spring Electric (26,8 kWh)</option>
      </select>

      <label>Capacità batteria (kWh)</label>
      <input type="number" step="0.1" id="capacita" value="26.8" readonly style="background:#333"/>

      <label>Batteria attuale (%)</label>
      <input type="number" id="percAttuale" min="1" max="99" value="35"/>

      <label>Potenza di ricarica reale (kW)</label>
      <input type="number" step="0.1" id="potenza" value="3.7"/>

      <button onclick="calcolaManuale()">Calcola tempo per 80%</button>
    </div>

    <div id="risultato" class="result">
      <div>Mancano <span id="tempoRimanente" class="time">--</span></div>
      <div>Arrivo all'80% alle <span id="orarioFinale" class="time">--</span></div>
      <div id="impattoTemp" class="impact"></div>
    </div>
  </div>

  <script>
    // CURVA DEFINITIVA – DICEMBRE 2025 – calibrata sui tuoi test reali
    function getTempFactor(temp, potenza = null) {
      temp = parseFloat(temp);
      const isSlowCharge = potenza !== null && potenza <= 3.8;
      if (temp >= 15) return 1.0;
      if (isSlowCharge) {
        if (temp >= 10) return 1.35;
        if (temp >= 7)  return 1.70;
        if (temp >= 5)  return 2.00;
        if (temp >= 3)  return 2.18;
        if (temp >= 1)  return 2.35;
        if (temp >= -2) return 2.55;
        if (temp >= -5) return 2.80;
        return 3.0 + (temp * -0.08);
      } else {
        if (temp >= 10) return 1.15;
        if (temp >= 7)  return 1.35;
        if (temp >= 3)  return 1.62;
        if (temp >= 0)  return 1.85;
        return 2.1 + (temp * -0.05);
      }
    }

    function calcolaManuale() {
      const perc = parseFloat(document.getElementById('percAttuale').value) || 0;
      const cap = parseFloat(document.getElementById('capacita').value) || 0;
      const kw = parseFloat(document.getElementById('potenza').value) || 0;
      const usaTemp = document.getElementById('usaTemp').checked;
      const temp = usaTemp ? parseFloat(document.getElementById('temperatura').value) : 25;

      if (perc < 1 || perc >= 100 || !cap || !kw) {
        alert("Controlla i dati inseriti");
        return;
      }

      const kWhDaCaricare = (80 - perc) / 100 * cap;
      let minuti = (kWhDaCaricare / kw) * 60;
      const fattore = usaTemp ? getTempFactor(temp, kw) : 1;
      minuti *= fattore;

      const h = Math.floor(minuti / 60);
      const m = Math.round(minuti % 60);
      const testoTempo = h > 0 ? `${h}h ${m}min` : `${m} minuti`;

      const ora = new Date();
      ora.setMinutes(ora.getMinutes() + Math.round(minuti));
      const orario = ora.toLocaleTimeString('it-IT', {hour:'2-digit', minute:'2-digit'});

      document.getElementById('tempoRimanente').textContent = testoTempo;
      document.getElementById('orarioFinale').textContent = orario;

      const impatto = usaTemp && fattore > 1.01
        ? `Temperatura ${temp}°C → +${Math.round((fattore-1)*100)}% tempo`
        : '';
      const el = document.getElementById('impattoTemp');
      el.textContent = impatto;
      el.style.display = impatto ? 'block' : 'none';

      document.getElementById('risultato').classList.add('show');
    }

    window.toggleTemp = () => {
      document.getElementById('temperatura').style.display =
        document.getElementById('usaTemp').checked ? 'block' : 'none';
    };

    window.impostaCapacita = () => {
      const sel = document.getElementById('modelloAuto');
      const input = document.getElementById('capacita');
      if (sel.value === "spring") {
        input.value = "26.8"; input.readOnly = true;
      } else {
        input.value = ""; input.readOnly = false; input.focus();
      }
    };
  </script>
</body>
</html>
